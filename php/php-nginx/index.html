<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Getúlio Vinicius <getuliovinits@gmail.com">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>PHP - com Nginx - Configurações</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "PHP - com Nginx";
    var mkdocs_page_input_path = "php/php-nginx.md";
    var mkdocs_page_url = "/php/php-nginx/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-70830801-12', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Configurações</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Configurações</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Sistemas Operacionais</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../sistemas-operacionais/arch-linux/">Arch Linux</a>
                </li>
                <li class="">
                    
    <a class="" href="../../sistemas-operacionais/debian9/">Debian9</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Git</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../git/git/">Git</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Shell</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../shell/zsh/">zsh</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python/virtualenv/">virtualenv</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python/mkdocs/">Mkdocs</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">PHP</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../php-apache/">PHP - com Apache</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">PHP - com Nginx</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#ambiente_php_-_com_nginx">Ambiente PHP - com Nginx</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#instalacao_do_php">Instalação do PHP</a></li>
        
            <li><a class="toctree-l4" href="#virtualhost_para_o_ambiente_php">VirtualHost para o ambiente PHP</a></li>
        
            <li><a class="toctree-l4" href="#gerenciador_de_dependencias_composer">Gerenciador de dependências Composer</a></li>
        
            <li><a class="toctree-l4" href="#configurar_diretorios_de_desenvolvimento">Configurar diretórios de desenvolvimento</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../phpmyadmin/">Phpmyadmin</a>
                </li>
                <li class="">
                    
    <a class="" href="../hesk/">Hesk</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Java</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../java/jre/">JRE</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Node.JS</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../nodejs/nodejs/">Node.JS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Servidores Web</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../servidores-web/apache/">Apache2</a>
                </li>
                <li class="">
                    
    <a class="" href="../../servidores-web/nginx/">Nginx</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Banco de Dados</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../banco-de-dados/mysql/">MySQL</a>
                </li>
                <li class="">
                    
    <a class="" href="../../banco-de-dados/mariadb/">MariaDB</a>
                </li>
                <li class="">
                    
    <a class="" href="../../banco-de-dados/mongodb/">MongoDB</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Editores</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../editores-de-codigo/atom/">Atom</a>
                </li>
                <li class="">
                    
    <a class="" href="../../editores-de-codigo/brackets/">Brackets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../editores-de-codigo/sublime-text/">Sublime Text</a>
                </li>
                <li class="">
                    
    <a class="" href="../../editores-de-codigo/vs-code/">VS Code</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Configurações</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>PHP &raquo;</li>
        
      
    
    <li>PHP - com Nginx</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/getuliovinicius/configuracoes/blob/master/mds/php/php-nginx.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ambiente_php_-_com_nginx">Ambiente PHP - com Nginx<a class="headerlink" href="#ambiente_php_-_com_nginx" title="Permanent link">&para;</a></h1>
<p><em>Versão 1 - atualizada em 30/07/2017</em></p>
<hr />
<p><em>PHP</em> é uma linguagem de <em>scripts</em> de propósito geral que é especialmente adequado para desenvolvimento web. <em>PHP</em> é um acrônimo para &ldquo;Pré Processor HiperText&rdquo;, mas e daí ;)</p>
<h2 id="instalacao_do_php">Instalação do PHP<a class="headerlink" href="#instalacao_do_php" title="Permanent link">&para;</a></h2>
<p><strong>Procedimento para instalar o <em>PHP</em> no sistema operacional _Debian9 - Stretch:</strong></p>
<p>Partindo para a instalação, o comando abaixo vai instalar o básico do PHP:</p>
<pre class="codehilite"><code class="language-bash">$ sudo apt install php7.0-fpm php7.0-mysql php7.0-curl php7.0-mcrypt php7.0-mbstring php7.0-gd</code></pre>


<div class="admonition note">
<p class="admonition-title">Info</p>
<p><strong>Pacotes instalados:</strong> libmcrypt4 php-common php7.0-cli php7.0-common php7.0-curl php7.0-fpm php7.0-json php7.0-mbstring php7.0-mcrypt php7.0-mysql php7.0-opcache php7.0-readline</p>
</div>
<p>Para checar a instalação do PHP execute o comando:</p>
<pre class="codehilite"><code class="language-bash">$ php --version</code></pre>


<p>Após a instalação, um parâmetro de configuração do PHP, <code>cgi.fix_pathinfo</code>, foi ajustado.</p>
<pre class="codehilite"><code class="language-bash">$ sudo vim /etc/php/7.0/fpm/php.ini</code></pre>


<pre class="codehilite"><code>cgi.fix_pathinfo=0</code></pre>


<pre class="codehilite"><code class="language-bash">$ sudo vim /etc/php/7.0/fpm/php.ini</code></pre>


<h2 id="virtualhost_para_o_ambiente_php">VirtualHost para o ambiente PHP<a class="headerlink" href="#virtualhost_para_o_ambiente_php" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Info</p>
<p>Totalmente opcional.</p>
</div>
<p>Para testar o funcionamento vamos criar um <em>VirtualHost</em>, ou simplesmente <em>vHost</em>, que sirva para checar o ambiente PHP e todas as suas características. Começaremos com a estrutura de diretórios para projetos de páginas dinâmicas em PHP.</p>
<pre class="codehilite"><code class="language-bash">$ sudo mkdir -p /srv/www/php/ambiente-php.local
$ cd /srv/www/php/ambiente-php.local</code></pre>


<p>Crie um arquivo <code>info.php</code> dentro do diretório recém criado:</p>
<pre class="codehilite"><code class="language-bash">$ sudo vim index.php</code></pre>


<p>Copie o conteúdo abaixo para o arquivo:</p>
<pre class="codehilite"><code class="language-php">&lt;?php
phpinfo();
?&gt;</code></pre>


<p>Alterar o proprietário dos diretórios e arquivos em <code>/srv/www</code> para o usuário e grupo <code>nginx</code>:</p>
<pre class="codehilite"><code class="language-bash">$ sudo chown www-data\: /srv/www -R</code></pre>


<p>Na sequência é preciso configurar o <em>vhost</em>.</p>
<pre class="codehilite"><code class="language-bash">$ cd /etc/nginx/sites-available</code></pre>


<p>Criar um arquivo chamado <code>ambiente-php.local.conf</code>:</p>
<pre class="codehilite"><code class="language-bash">$ sudo vim /etc/nginx/sites-available/ambiente-php.local.conf</code></pre>


<p>Copie o conteúdo abaixo para o arquivo:</p>
<pre class="codehilite"><code>server {

    # Port that the web server will listen on.
    listen 80;

    # Host that will serve this project.
    server_name ambiente-php.local;

    #
    #charset koi8-r;

    # Useful logs for debug.
    access_log /var/log/nginx/ambiente-php.local.access.log;
    error_log /var/log/nginx/ambiente-php.local.error.log;
    rewrite_log on;

    # The location of our projects public directory.
    root /srv/www/php/ambiente-php.local;

    # Point index to the app front controller.
    index index.php index.html;

    # URLs to attempt, including pretty ones.
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    # Remove trailing slash to please routing system.
    if (!-d $request_filename) {
        rewrite ^/(.+)/$ /$1 permanent;
    }

    #
    #error_page 404 /404.html;

    # redirect server error pages to the static page /50x.html
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /srv/www/php/ambiente-php.local;
    }

    # PHP FPM configuration.
    location ~* \.php$ {
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
        fastcgi_index index.php;
        fastcgi_split_path_info ^(.+\.php)(.*)$;
        include /etc/nginx/fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    #
    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #location ~ \.php$ {
    #    proxy_pass http://127.0.0.1;
    #}

    #
    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #location ~* \.php$ {
    #    fastcgi_index index.php;
    #    fastcgi_pass 127.0.0.1:9000;
    #    include fastcgi_params;
    #    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    #    fastcgi_param SCRIPT_NAME $fastcgi_script_name;
    #}
    #location ~ \.php$ {
    #    root html;
    #    fastcgi_pass 127.0.0.1:9000;
    #    fastcgi_index index.php;
    #    fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;
    #    include fastcgi_params;
    #}

    #
    # We don't need .ht files with nginx.
    location ~ /\.ht {
        deny all;
    }

    # Set header expirations on per-project basis
    location ~* \.(?:ico|css|js|jpe?g|JPG|png|svg|woff)$ {
        expires 365d;
    }
}</code></pre>


<p>O novo <em>vHost</em> deve ser habilitado através da criação de um link simbólico em <code>/etc/nginx/sites-enabled</code>.</p>
<pre class="codehilite"><code class="language-bash">$ sudo ln -s /etc/nginx/sites-available/ambiente-php.local.conf /etc/nginx/sites-enabled/</code></pre>


<p>E adicionar a entrada para o <em>vHost</em> no arquivo <code>/etc/hosts</code>:</p>
<pre class="codehilite"><code class="language-bash">$ sudo vim /etc/hosts</code></pre>


<p>Adicione a linha abaixo após as entradas criadas anteriormente.</p>
<pre class="codehilite"><code class="language-rc">127.0.0.1   ambiente-php.local</code></pre>


<p>Acesse os endereços <a href="http://ambiente-php.local">http://ambiente-php.local</a> para verificar toda a configuração do PHP.</p>
<h2 id="gerenciador_de_dependencias_composer">Gerenciador de dependências Composer<a class="headerlink" href="#gerenciador_de_dependencias_composer" title="Permanent link">&para;</a></h2>
<p>O <em>Composer</em> pode ser instalado globalmente ou apenas no escopo do projeto que está em desenvolvimento. Siga as instruções abaixo para instalar globalmente, as mesmas podem podem ser vistas no site do gerenciador <a href="https://getcomposer.org/">https://getcomposer.org/</a>.</p>
<pre class="codehilite"><code class="language-bash">$ php -r &quot;copy('https://getcomposer.org/installer', 'composer-setup.php');&quot;
$ php -r &quot;if (hash_file('SHA384', 'composer-setup.php') === '669656bab3166a7aff8a7506b8cb2d1c292f042046c5a994c43155c0be6190fa0355160742ab2e1c88d40d5be660b410') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;&quot;
$ php composer-setup.php
$ php -r &quot;unlink('composer-setup.php');&quot;
$ sudo mv composer.phar /usr/local/bin/composer</code></pre>


<div class="admonition attention">
<p class="admonition-title">Atenção</p>
<p>A chave &lsquo;669656bab3166a7aff8a7506b8cb2d1c292f042046c5a994c43155c0be<br />
6190fa0355160742ab2e1c88d40d5be660b410&rsquo; pode não ser a mesma quando em uma instalação futura, é preciso conferir em <a href="https://getcomposer.org/download/">https://getcomposer.org/download/</a>.</p>
</div>
<p>Para verificar a versão do composer:</p>
<pre class="codehilite"><code class="language-bash">$ composer -V</code></pre>


<h2 id="configurar_diretorios_de_desenvolvimento">Configurar diretórios de desenvolvimento<a class="headerlink" href="#configurar_diretorios_de_desenvolvimento" title="Permanent link">&para;</a></h2>
<p>No Linux o único diretório com permissão de escrita para o usuário padrão, o usuário da instalação do sistema operacional, é o diretório <em>home</em> de sua conta: <code>/home/nome_usuario</code>.<br />
Por essa razão não dá pra editar o código PHP no local que instalamos as aplicações, ou seja, o diretório <code>/srv/www/php</code>. Sendo assim vamos mudar as configurações de forma sutil para termos acesso de leitura e escrita aos arquivos de código fonte das aplicações.</p>
<div class="admonition note">
<p class="admonition-title">info</p>
<p>Em outros tutoriais irei demonstrar a instalação de aplicações como: <em>Drupal, Phpmyadmin, MediaWiki e WordPress</em>, tais aplicações não necessitam de alterações no código, portanto serão sempre instaladas no diretório <code>/srv/www/php</code>. A configuração mostrada até agora reflete de forma fidedigna as configurações ideais para instalação de aplicações PHP em servidores de produção. Daqui em diante veremos como transformar a instalação em algo próprio para desenvolvimento.</p>
</div>
<p>O primeiro passo é criar um diretório no diretório <code>home</code> do usuário padrão, criado durante a instalação do sistema operacional Linux, por exemplo <code>/home/nome_usuario/DEV_WEB/PHP/VHOSTS</code>.</p>
<pre class="codehilite"><code class="language-bash">$ mkdir -p ~/DEV_WEB/PHP/VHOSTS</code></pre>


<div class="admonition note">
<p class="admonition-title">info</p>
<p>O <code>~</code> (til) é um curinga que substitui o diretório <code>home</code> no momento de digitar comandos no prompt.</p>
</div>
<p>Na pasta <code>VHOSTS</code> iremos criar propriamente nossas aplicações, portanto será ali que iremos colocar os diretórios <code>.local</code>, por exemplo:</p>
<pre class="codehilite"><code class="language-bash">$ cd ~/DEV_WEB/PHP/VHOSTS
$ mkdir projeto1.local</code></pre>


<p>Agora vamos criar um link simbólico para o diretório <em>projeto1.local</em> dentro do diretório reconhecido pelo Nginx <code>/srv/www/php/</code>:</p>
<pre class="codehilite"><code class="language-bash">$ cd /srv/www/php/
$ sudo ln -s ~/DEV_WEB/PHP/VHOSTS/projeto1.local .
$ sudo chown -R www-data\: projeto1.local</code></pre>


<p>Acessamos o diretório de desenvolvimento criado na <code>home</code> do usuário padrão:</p>
<pre class="codehilite"><code class="language-bash">$ cd ~/DEV_WEB/PHP/VHOSTS/</code></pre>


<p>Então passamos para a mudança sutil que nos permitirá o acesso com leitura e escrita aos códigos fonte de aplicações desenvolvidas em PHP.<br />
Alteramos o usuário dono, mas não o grupo, do diretório <code>~/DEV_WEB/PHP/VHOSTS/projeto1.local</code> para o usuário padrão:</p>
<pre class="codehilite"><code class="language-bash">$ sudo chown -R seu_uruario:www-data projeto1.local/</code></pre>


<p>De agora em diante é possível editar projetos, códigos de aplicações desenvolvidas em PHP, com editores de texto como o <em>Sublime Text</em>.<br />
Sempre que for rodar uma aplicação desenvolvida por você mesmo repita os passos a seguir, substituindo <em>projetoX.local</em> pelo nome que você deseja:</p>
<pre class="codehilite"><code class="language-bash">$ cd /srv/www/php/
$ sudo ln -s ~/DEV_WEB/PHP/VHOSTS/projetoX.local
$ sudo chown -R www-data\: projetoX.local
$ cd ~/DEV_WEB/PHP/VHOSTS
$ mkdir projetoX.local
$ sudo chown -R seu_uruario:www-data projetoX.local/</code></pre>


<p>A configuração dos <em>vHosts</em> e as entradas no arquivo <code>/etc/hosts</code> podem ser feitas conforme o exemplo em <a href="./#virtualhost_para_o_ambiente_php">VirtualHost para o ambiente PHP</a>.</p>
<div class="admonition note">
<p class="admonition-title">info</p>
<p>Acostume-se a lidar com permissões de arquivos, principalmente com os comandos <code>chown</code> e <code>chmod</code>, pois isso é fundamental no desenvolvimento e quem não sabe usar corretamente esses comandos faz cagada em servidores.<br />
Não é brincadeira. Saber usar o prompt de comando e conhecer o funcionamento de permissões e propriedades de arquivos e diretórios faz toda diferença.</p>
</div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../phpmyadmin/" class="btn btn-neutral float-right" title="Phpmyadmin">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../php-apache/" class="btn btn-neutral" title="PHP - com Apache"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/getuliovinicius/configuracoes/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../php-apache/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../phpmyadmin/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
